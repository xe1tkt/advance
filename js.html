<script>

    function crearTablaContactos()
    {
        //borrar tabla
        borrarTabla();
        
                //loader
                crearLoader('divContactos');
        google.script.run
        .withSuccessHandler(crearTablaContactosOK)
        .withFailureHandler(crearTablaContactosError)
        .obtenerContactos();


    }
    
    function insertarContacto()
    {
        let nombre=document.getElementById('nombre').value;
        let apellidos=document.getElementById('apellidos').value;
        let telf=document.getElementById('telf').value;
        let correo=document.getElementById('correo').value;
        google.script.run
        .withSuccessHandler(contactoInsertOK)
        .withFailureHandler(contactoInsertError)
        .insertarContacto(nombre,apellidos,correo,telf);
        borrarTabla();
        //cerrar modal
       
        let modal= bootstrap.Modal.getInstance(document.getElementById('crearContactoModal')).hide();

    }

    function contactoInsertOK()
    {
        document.getElementById('nombre').value='';
        document.getElementById('correo').value='';
        creartNotificacionOK('contacto insertado','contacto OK');
        elimnarLoader();
        crearTablaContactos();
    }

    function contactoInsertError()
    {
        creartNotificacionError('Error al insertar','tache');
        elimnarLoader();
        crearTablaContactos();
        
    }
            
    function crearTablaContactosOK(obj)
            { 
            tabla=document.createElement('table');
            tabla.id='tablaContactos';
            let tablaHeader=document.createElement('thead');
            let tablaBody = document.createElement('tbody');

            Array.from(obj).forEach((filaActual,i)=>
            {
                let fila=document.createElement('tr');
                filaActual.forEach(celdaActual=>
                {
                    let celda=document.createElement('td');
                    celda.textContent=celdaActual;
                    fila.appendChild(celda);
                });
                if(i==0)
                {
                    tablaHeader.appendChild(fila);
                    tabla.appendChild(tablaHeader);
                }
                else
                {
                    tablaBody.appendChild(fila);
                }
                

            });
            tabla.appendChild(tablaBody);
            tablaHeader.classList.add('table-dark');
            tabla.classList.add('table','table-striped','border','border-3','table-success');
            document.getElementById('divContactos').appendChild(tabla);
               //mostrar notificacion
               creartNotificacionOK('Contactos obtenidos','todo en orden'); 
               elimnarLoader();
            }

            

    function crearTablaContactosError()
    {
        //error not
        creartNotificacionError('No se pueden obtener los datos','Error');
        elimnarLoader();
    }

function crearNotificacion(mensaje,titulo)
{
    document.getElementById('mensajeNotificacion').textContent=mensaje;
    document.getElementById('tituloNotificacion').textContent=titulo;
    let elementoNotificacion=document.getElementById('notificacion');
    bootstrap.Toast.getOrCreateInstance(elementoNotificacion).show();
}

function creartNotificacionOK(mensaje,titulo)
{
    crearNotificacion(mensaje,titulo);
    crearIconoOK();
    crearColorNotificacion('--color-verde-oscuro');

}
function creartNotificacionAdvertencia(mensaje,titulo)
{
    crearNotificacion(mensaje,titulo);
    crearIconoAdvertencia();
    crearColorNotificacion('--color-amarillo-oscuro');

}
function creartNotificacionError(mensaje,titulo)
{
    crearNotificacion(mensaje,titulo);
    crearIconoError();
    crearColorNotificacion('--color-rojo-oscuro');
}
function crearIconoOK()
{
    document.getElementById('iconoNotificacion').className='';
    document.getElementById('iconoNotificacion').classList.add('bi','bi-check2-square');
}

function crearIconoError()
{
    document.getElementById('iconoNotificacion').className='';
    document.getElementById('iconoNotificacion').classList.add('bi','bi-bug');
    
}

function crearIconoAdvertencia()
{
    document.getElementById('iconoNotificacion').className='';
    document.getElementById('iconoNotificacion').classList.add('bi','bi-exclamation-square');
}
function crearColorNotificacion(color)
{
    let elementoNotificacion = document.getElementById('notificacion');
    elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue(color);
            
}

function crearLoader(elementoPadre)
        {
            elimnarLoader();
            let loader = document.createElement('div');
            loader.id='loader';
            loader.appendChild(document.createElement('div'));
            loader.appendChild(document.createElement('div'));
            loader.appendChild(document.createElement('div'));
            loader.appendChild(document.createElement('div'));
            loader.classList.add('.lds-ellipsis');
            document.getElementById(elementoPadre).appendChild(loader);


        }

        function elimnarLoader()
        {
            let loader = document.getElementById('loader');
            if (loader) loader.remove();
        }
        function borrarTabla()
        {
            let tabla=document.getElementById('tablaContactos');
            if(tabla) tabla.remove();

        }

</script>